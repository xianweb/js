<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS高级编程 | 桌面通知 Notification</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/js/assets/css/12.styles.e33a4478.css" as="style"><link rel="preload" href="/js/assets/js/app.cfcd0482.js" as="script"><link rel="preload" href="/js/assets/js/9.0c5d26db.js" as="script"><link rel="prefetch" href="/js/assets/js/4.a36cd5d1.js"><link rel="prefetch" href="/js/assets/js/0.675c1eb8.js"><link rel="prefetch" href="/js/assets/js/1.82f3f08a.js"><link rel="prefetch" href="/js/assets/js/2.ad68dd99.js"><link rel="prefetch" href="/js/assets/js/3.46f19ff2.js"><link rel="prefetch" href="/js/assets/js/5.dcbe4673.js"><link rel="prefetch" href="/js/assets/js/6.a1393811.js"><link rel="prefetch" href="/js/assets/js/7.948ac6a7.js"><link rel="prefetch" href="/js/assets/js/8.99f6d086.js"><link rel="prefetch" href="/js/assets/js/10.6a62cb63.js"><link rel="prefetch" href="/js/assets/js/11.e517648c.js">
    <link rel="stylesheet" href="/js/assets/css/12.styles.e33a4478.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/js/" class="home-link router-link-active"><!----><span class="site-name">
      JS高级编程
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><a href="/js/page1.html" class="sidebar-link">数组</a></li><li><a href="/js/page2.html" class="sidebar-link">对象</a></li><li><a href="/js/page3.html" class="sidebar-link">JSON数据</a></li><li><a href="/js/page4.html" class="sidebar-link">JS原型与原型链</a></li><li><a href="/js/page5.html" class="sidebar-link">this指针、call和apply的区别</a></li><li><a href="/js/page6.html" class="sidebar-link">AJAX、跨域、服务器交互</a></li><li><a href="/js/page7.html" class="sidebar-link">JS面向对象</a></li><li><a href="/js/page8.html" class="sidebar-link">闭包</a></li><li><a href="/js/page9.html" class="sidebar-link">WebSocket教程</a></li><li><a href="/js/page10.html" class="sidebar-link">ES6常用特性</a></li><li><a href="/js/page11.html" class="active sidebar-link">桌面通知 Notification</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/page11.html#为什么需要html5的桌面通知" class="sidebar-link">为什么需要HTML5的桌面通知</a></li><li class="sidebar-sub-header"><a href="/js/page11.html#一个桌面通知生成的正常流程" class="sidebar-link">一个桌面通知生成的正常流程</a></li><li class="sidebar-sub-header"><a href="/js/page11.html#notification-api基础说明及代码示例" class="sidebar-link">notification api基础说明及代码示例</a></li><li class="sidebar-sub-header"><a href="/js/page11.html#notification" class="sidebar-link">Notification:</a></li></ul></li></ul></div><div class="page"><div class="content"><h1 id="桌面通知-notification"><a href="#桌面通知-notification" aria-hidden="true" class="header-anchor">#</a> 桌面通知 Notification</h1><h2 id="为什么需要html5的桌面通知"><a href="#为什么需要html5的桌面通知" aria-hidden="true" class="header-anchor">#</a> 为什么需要HTML5的桌面通知</h2><p>传统的桌面通知可以写一个<code>div</code>放到页面右下角自动弹出来，并通过轮询等等其他方式去获取消息并推送给用户。这种方式有个弊端就是：当我在使用京东 进行购物的时候，我是不知道人人网有消息推送过来给我的，而必须要等我把当前页面切到人人网才知道有消息推送了。这种方式的消息推送它是基于页面存活的， 但是我们需要这么一种策略：无论你在看哪个页面，只要有消息都应该能推送给我看到，这就是<code>webkitNotification</code>要解决的问题。 <code>Notification</code>生成的消息不依附于某个页面，仅仅依附于浏览器。</p><h2 id="一个桌面通知生成的正常流程"><a href="#一个桌面通知生成的正常流程" aria-hidden="true" class="header-anchor">#</a> 一个桌面通知生成的正常流程</h2><p>我们先来看看一个桌面通知是如何生成的：</p><ul><li>检查浏览器是否支持<code>Notification</code></li><li>检查浏览器的通知权限（是否允许通知）</li><li>若权限不够则获取浏览器的通知权限</li><li>创建消息通知</li><li>展示消息通知</li><li><code>NOTE:</code> 关于第一点的说明需要做一些说明，<code>Notification</code>目前还没有标准化，所以目前只支持<code>chrome19+</code>和<code>safari6+</code>；网上有资料显示<code>Firefox26+</code>也支持，但是我拿我的<code>Firefox27</code>检测的结果是无法支持。</li></ul><h2 id="notification-api基础说明及代码示例"><a href="#notification-api基础说明及代码示例" aria-hidden="true" class="header-anchor">#</a> notification api基础说明及代码示例</h2><p>目前<code>notification</code>的实现有两种：一种是之前草案中的形式：<code>webkitNotifications</code>对象, 另一种就是未来标准化的形式:<code>Notification</code>对象。首先来说一下<code>webkitNotifications</code>所包含的内容：</p><h3 id="webkitnotifications："><a href="#webkitnotifications：" aria-hidden="true" class="header-anchor">#</a> webkitNotifications：</h3><pre class="language-js"><code>window<span class="token punctuation">.</span>webkitNotifications<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//该方法返回0, 1, 2三个值</span>
<span class="token comment">//0代表PERMISSION_ALLOWED,即允许</span>
<span class="token comment">//1代表PERMISSION_NOT_ALLOWED，即不允许</span>
<span class="token comment">//2代表PERMISSION_DENIED，即拒绝</span>

window<span class="token punctuation">.</span>webkitNotifications<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//调用该方法将会在浏览器的信息栏弹出一个是否允许桌面通知的提醒，该方法只能由用户主动事件触发，如click 或 mouse over，也就是说你不能在document.ready里面直接调用该方法。</span>

window<span class="token punctuation">.</span>webkitNotifications<span class="token punctuation">.</span><span class="token function">createNotification</span><span class="token punctuation">(</span><span class="token string">'icon-url'</span><span class="token punctuation">,</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">)</span>
<span class="token comment">//调用该方法将返回一个实例化的webkitNotifications对象</span>
</code></pre><div class="warning custom-block"><p class="custom-block-title">注意</p><p>调用以上方法都会存在安全异常，也就是当前页面的<code>permission</code>是否为0。</p></div><h3 id="实例方法"><a href="#实例方法" aria-hidden="true" class="header-anchor">#</a> 实例方法</h3><pre class="language-js"><code>notificationInstance<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//调用该方法将在右下角弹出一个通知窗口</span>
notificationInstance<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//调用该方法将关闭通知窗口</span>
</code></pre><h2 id="notification"><a href="#notification" aria-hidden="true" class="header-anchor">#</a> Notification:</h2><p>在<code>chrome26+</code> 终端里面输入<code>window.Notification</code>并键入回车键，会发现这东西它也是存在的，根据某些博客的说法，这个<code>Notification</code>会是 <code>webkitNotifications</code>的标准化形态（传说中的进化），这种方式的实现相对于<code>webkitNotifications</code>的实现更简洁，更面 向对象一些。 构造函数：</p><pre class="language-js"><code><span class="token function">Notification</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token comment">//@param {String} title 要显示的通知标题</span>
<span class="token comment">//@param {Object} options 备选项参数，键值对</span>
<span class="token comment">//option 结构如下</span>
dictionary NotificationOptions <span class="token punctuation">{</span>
  NotificationDirection dir <span class="token operator">=</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">;</span>
  DOMString lang <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  DOMString body<span class="token punctuation">;</span>
  DOMString tag<span class="token punctuation">;</span>
  DOMString icon<span class="token punctuation">;</span><span class="token comment">//在实例化的时候会异步的去获取</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>//新建一个<code>Notification</code>实例,并根据<code>permission</code>为'granted'来完成<code>notification</code>的显示</p><pre class="language-js"><code><span class="token keyword">var</span> notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'Hello Notification'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>body<span class="token punctuation">:</span><span class="token string">&quot;I'm an enginneer!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="静态属性"><a href="#静态属性" aria-hidden="true" class="header-anchor">#</a> 静态属性:</h3><p>Notification.Permission:</p><blockquote><p>'default' 等同于拒绝 'denied' 意味着用户不想要通知
'granted' 意味着用户同意启用通知</p></blockquote><p>Test:在chrome的地址栏里面输入<code>http://www.baidu.com</code>, 打开<code>console</code>，并在里面输入<code>Notification.Permission</code> 默认返回的是'default'。</p><p>Notes:该属性是只读的不能手动修改</p><pre class="language-js"><code><span class="token comment">//在百度的首页打开console</span>
Notification<span class="token punctuation">.</span>Permission <span class="token operator">=</span> <span class="token string">'granted'</span>
Notification<span class="token punctuation">.</span>Permission   <span class="token comment">//'default'</span>
</code></pre><h3 id="实例属性："><a href="#实例属性：" aria-hidden="true" class="header-anchor">#</a> 实例属性：</h3><p>以下属性都需要在<code>Notification</code>实例上才能访问，为只读属性，并且就是通过<code>option</code>来赋值</p><pre class="language-js"><code>Notification<span class="token punctuation">.</span>dir    <span class="token comment">//</span>
Notification<span class="token punctuation">.</span>lang
Notification<span class="token punctuation">.</span>Body   <span class="token comment">//通知的具体内容</span>
Notification<span class="token punctuation">.</span>tag    <span class="token comment">//实例化的notification的id</span>
Notification<span class="token punctuation">.</span>icon   <span class="token comment">//通知的缩略图</span>
</code></pre><h3 id="静态方法："><a href="#静态方法：" aria-hidden="true" class="header-anchor">#</a> 静态方法：</h3><p><code>Notification.requestPermission()</code> 该方法将会询问用户是否允许显示通知，该方法不能由页面自主调用，必须由用户主动事件触发，还是以百度的页面为例，百度的搜索框的id为'kw'：</p><pre class="language-js"><code><span class="token comment">//不通过事件触发直接调用</span>
Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//页面无反应</span>
</code></pre><pre class="language-js"><code> <span class="token comment">//通过用户主动事件触发来调用</span>
 document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'kw'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
     Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//页面信息栏会弹出询问用户是否允许显示桌面通知</span>

</code></pre><div class="danger custom-block"><p class="custom-block-title">注意</p><p>当用户同意之后，再次调用该方法则无效，即该方法仅对<code>Notification.Permission</code>不为'granted'的时候起作用</p></div><h3 id="实例方法-2"><a href="#实例方法-2" aria-hidden="true" class="header-anchor">#</a> 实例方法</h3><pre class="language-js"><code>Notification<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">//该方法允许通过代码控制关掉notification</span>
</code></pre><div class="danger custom-block"><p class="custom-block-title">提示</p><p><code>Notification</code> 没有实例方法<code>show()</code>,在<code>Notification</code>实例化的时候，浏览器就已经自动的去处理<code>notification</code>的显示过程了。</p></div><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/jquery/2.1.1/jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>有人想加你为好友<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    JS代码：
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Notification<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     text <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> <span class="token function-variable function">popNotice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">==</span> <span class="token string">&quot;granted&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">&quot;Hi，帅哥：&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                body<span class="token punctuation">:</span> <span class="token string">'可以加你为好友吗？'</span><span class="token punctuation">,</span>
                icon<span class="token punctuation">:</span> <span class="token string">'http://image.zhangxinxu.com/image/study/s/s128/mm1.jpg'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            notification<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                text<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'张小姐已于'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'加你为好友！'</span><span class="token punctuation">;</span>
                notification<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">==</span> <span class="token string">&quot;granted&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">popNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!=</span> <span class="token string">&quot;denied&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>permission<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">popNotice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'浏览器不支持Notification'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/js/page10.html" class="prev">
          ES6常用特性
        </a></span><!----></p></div></div></div></div>
    <script src="/js/assets/js/9.0c5d26db.js" defer></script><script src="/js/assets/js/app.cfcd0482.js" defer></script>
  </body>
</html>
