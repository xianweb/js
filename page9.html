<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS高级编程 | WebSocket教程</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/js/assets/css/12.styles.e33a4478.css" as="style"><link rel="preload" href="/js/assets/js/app.cfcd0482.js" as="script"><link rel="preload" href="/js/assets/js/1.82f3f08a.js" as="script"><link rel="prefetch" href="/js/assets/js/4.a36cd5d1.js"><link rel="prefetch" href="/js/assets/js/0.675c1eb8.js"><link rel="prefetch" href="/js/assets/js/2.ad68dd99.js"><link rel="prefetch" href="/js/assets/js/3.46f19ff2.js"><link rel="prefetch" href="/js/assets/js/5.dcbe4673.js"><link rel="prefetch" href="/js/assets/js/6.a1393811.js"><link rel="prefetch" href="/js/assets/js/7.948ac6a7.js"><link rel="prefetch" href="/js/assets/js/8.99f6d086.js"><link rel="prefetch" href="/js/assets/js/9.0c5d26db.js"><link rel="prefetch" href="/js/assets/js/10.6a62cb63.js"><link rel="prefetch" href="/js/assets/js/11.e517648c.js">
    <link rel="stylesheet" href="/js/assets/css/12.styles.e33a4478.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/js/" class="home-link router-link-active"><!----><span class="site-name">
      JS高级编程
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><a href="/js/page1.html" class="sidebar-link">数组</a></li><li><a href="/js/page2.html" class="sidebar-link">对象</a></li><li><a href="/js/page3.html" class="sidebar-link">JSON数据</a></li><li><a href="/js/page4.html" class="sidebar-link">JS原型与原型链</a></li><li><a href="/js/page5.html" class="sidebar-link">this指针、call和apply的区别</a></li><li><a href="/js/page6.html" class="sidebar-link">AJAX、跨域、服务器交互</a></li><li><a href="/js/page7.html" class="sidebar-link">JS面向对象</a></li><li><a href="/js/page8.html" class="sidebar-link">闭包</a></li><li><a href="/js/page9.html" class="active sidebar-link">WebSocket教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/page9.html#为什么需要-websocket？" class="sidebar-link">为什么需要 WebSocket？</a></li><li class="sidebar-sub-header"><a href="/js/page9.html#websocket简介" class="sidebar-link">WebSocket简介</a></li><li class="sidebar-sub-header"><a href="/js/page9.html#客户端的简单示例" class="sidebar-link">客户端的简单示例</a></li><li class="sidebar-sub-header"><a href="/js/page9.html#客户端的-api" class="sidebar-link">客户端的 API</a></li><li class="sidebar-sub-header"><a href="/js/page9.html#服务端的实现" class="sidebar-link">服务端的实现</a></li></ul></li><li><a href="/js/page10.html" class="sidebar-link">ES6常用特性</a></li><li><a href="/js/page11.html" class="sidebar-link">桌面通知 Notification</a></li></ul></div><div class="page"><div class="content"><h1 id="websocket教程"><a href="#websocket教程" aria-hidden="true" class="header-anchor">#</a> WebSocket教程</h1><p>WebSocket 是一种网络通信协议，很多高级功能都需要它。</p><h2 id="为什么需要-websocket？"><a href="#为什么需要-websocket？" aria-hidden="true" class="header-anchor">#</a> 为什么需要 WebSocket？</h2><p>初次接触 <code>WebSocket</code> 的人，都会问同样的问题：我们已经有了 <code>HTTP</code> 协议，为什么还需要另一个协议？它能带来什么好处？</p><p>答案很简单，因为 <code>HTTP</code> 协议有一个缺陷：<strong>通信只能由客户端发起</strong>。</p><p>举例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。<code>HTTP</code> 协议做不到服务器主动向客户端推送信息。</p><p>这种单向请求的特点，注定了如果<strong>服务器有连续的状态变化</strong>，客户端要获知就<strong>非常麻烦</strong>。我们只能使用&quot;<strong>轮询</strong>&quot;：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是<strong>聊天室</strong>。</p><p><strong>轮询的效率低</strong>，<strong>非常浪费资源</strong>（因为必须不停连接，或者 <code>HTTP</code> 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。<code>WebSocket</code> 就是这样发明的。</p><h2 id="websocket简介"><a href="#websocket简介" aria-hidden="true" class="header-anchor">#</a> WebSocket简介</h2><p><code>WebSocket</code> 协议在<code>2008</code>年诞生，<code>2011</code>年成为国际标准。所有浏览器都已经支持了。</p><p>它的最大特点就是，<strong>服务器可以主动向客户端推送信息</strong>，<strong>客户端也可以主动向服务器发送信息</strong>，是真正的双向平等对话，属于<strong>服务器推送技术</strong>的一种。</p><p><img src="/js/assets/img/websocket1.01881d8f.png" alt></p><h3 id="其他特点包括："><a href="#其他特点包括：" aria-hidden="true" class="header-anchor">#</a> 其他特点包括：</h3><ul><li><p>建立在 TCP 协议之上，服务器端的实现比较容易。</p></li><li><p>与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用
HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p></li><li><p>数据格式比较轻量，性能开销小，通信高效。</p></li><li><p>可以发送文本，也可以发送二进制数据。</p></li><li><p>没有同源限制，客户端可以与任意服务器通信。</p></li><li><p>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</p></li></ul><pre class="language-js"><code>ws<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">80</span><span class="token operator">/</span>some<span class="token operator">/</span>path
</code></pre><p><img src="/js/assets/img/websocket2.49345da6.jpg" alt></p><h2 id="客户端的简单示例"><a href="#客户端的简单示例" aria-hidden="true" class="header-anchor">#</a> 客户端的简单示例</h2><p>WebSocket 的用法相当简单。</p><p>下面是一个网页脚本的例子（点击<a href="http://jsbin.com/muqamiqimu/edit?js,console" target="_blank" rel="noopener noreferrer">这里</a>看运行结果），基本上一眼就能明白。</p><pre class="language-js"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://echo.websocket.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection open ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello WebSockets!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Received Message: &quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>      
</code></pre><h2 id="客户端的-api"><a href="#客户端的-api" aria-hidden="true" class="header-anchor">#</a> 客户端的 API</h2><p>WebSocket 客户端的 API 如下。</p><h3 id="websocket-构造函数"><a href="#websocket-构造函数" aria-hidden="true" class="header-anchor">#</a> WebSocket 构造函数</h3><p><code>WebSocket</code> 对象作为一个构造函数，用于新建 <code>WebSocket</code> 实例。</p><pre class="language-js"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>执行上面语句之后，客户端就会与服务器进行连接。</p><h3 id="websocket-readystate"><a href="#websocket-readystate" aria-hidden="true" class="header-anchor">#</a> webSocket.readyState</h3><p><code>readyState</code> 属性返回实例对象的当前状态，共有四种。</p><ul><li><strong>CONNECTING</strong>：值为0，表示正在连接。</li><li><strong>OPEN</strong>：值为1，表示连接成功，可以通信了。</li><li><strong>CLOSING</strong>：值为2，表示连接正在关闭。</li><li><strong>CLOSED</strong>：值为3，表示连接已经关闭，或者打开连接失败。</li></ul><p>下面是一个示例。</p><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token punctuation">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSING</span><span class="token punctuation">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token punctuation">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token comment">// this never happens</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="websocket-onopen"><a href="#websocket-onopen" aria-hidden="true" class="header-anchor">#</a> webSocket.onopen</h3><p>实例对象的<code>onopen</code>属性，用于指定连接成功后的回调函数。</p><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>如果要指定多个回调函数，可以使用<code>addEventListener</code>方法。</p><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="websocket-onclose"><a href="#websocket-onclose" aria-hidden="true" class="header-anchor">#</a> webSocket.onclose</h3><p>实例对象的<code>onclose</code>属性，用于指定连接关闭后的回调函数。</p><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> event<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">var</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
  <span class="token keyword">var</span> wasClean <span class="token operator">=</span> event<span class="token punctuation">.</span>wasClean<span class="token punctuation">;</span>
  <span class="token comment">// handle close event</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> event<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">var</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
  <span class="token keyword">var</span> wasClean <span class="token operator">=</span> event<span class="token punctuation">.</span>wasClean<span class="token punctuation">;</span>
  <span class="token comment">// handle close event</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="websocket-onmessage"><a href="#websocket-onmessage" aria-hidden="true" class="header-anchor">#</a> webSocket.onmessage</h3><p>实例对象的<code>onmessage</code>属性，用于指定收到服务器数据后的回调函数。</p><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">// 处理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">// 处理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="warning custom-block"><p class="custom-block-title">注意</p><p>注意，服务器数据可能是文本，也可能是二进制数据（<code>blob</code>对象或<code>Arraybuffer</code>对象）。</p></div><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>data <span class="token operator">===</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received data string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data <span class="token keyword">instanceof</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> buffer <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received arraybuffer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>除了动态判断收到的数据类型，也可以使用<code>binaryType</code>属性，显式指定收到的二进制数据类型。</p><pre class="language-js"><code><span class="token comment">// 收到的是 blob 数据</span>
ws<span class="token punctuation">.</span>binaryType <span class="token operator">=</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 收到的是 ArrayBuffer 数据</span>
ws<span class="token punctuation">.</span>binaryType <span class="token operator">=</span> <span class="token string">&quot;arraybuffer&quot;</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h3 id="websocket-send"><a href="#websocket-send" aria-hidden="true" class="header-anchor">#</a> webSocket.send()</h3><p>实例对象的<code>send()</code>方法用于向服务器发送数据。</p><p>发送文本的例子。</p><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'your message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>发送 <code>Blob</code> 对象的例子。</p><pre class="language-js"><code><span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;file&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>发送 <code>ArrayBuffer</code> 对象的例子。</p><pre class="language-js"><code><span class="token comment">//发送 canvas ImageData as ArrayBuffer</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> canvas_context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> binary <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> img<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  binary<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>binary<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="websocket-bufferedamount"><a href="#websocket-bufferedamount" aria-hidden="true" class="header-anchor">#</a> webSocket.bufferedAmount</h3><p>实例对象的<code>bufferedAmount</code>属性，表示还有多少字节的二进制数据没有发送出去。它可以用来判断发送是否结束。</p><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>bufferedAmount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送完毕</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送还没结束</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="websocket-onerror"><a href="#websocket-onerror" aria-hidden="true" class="header-anchor">#</a> webSocket.onerror</h3><p>实例对象的<code>onerror</code>属性，用于指定报错时的回调函数。</p><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle error event</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle error event</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="服务端的实现"><a href="#服务端的实现" aria-hidden="true" class="header-anchor">#</a> 服务端的实现</h2><p>常用的 Node 实现有以下三种。</p><ul><li>µWebSockets</li><li>Socket.IO</li><li>WebSocket-Node</li></ul><p>具体的用法请查看它们的文档，这里不详细介绍了。</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/js/page8.html" class="prev">
          闭包
        </a></span><span class="next"><a href="/js/page10.html">
          ES6常用特性
        </a> →
      </span></p></div></div></div></div>
    <script src="/js/assets/js/1.82f3f08a.js" defer></script><script src="/js/assets/js/app.cfcd0482.js" defer></script>
  </body>
</html>
